language: go
os: linux

go:
  - 1.15.x
  - 1.14.x
  - tip

env:
  global:
    - GO111MODULE=off
    - GO111MODULE=on
    # REVIEWDOG_GITHUB_API_TOKEN
    - secure: MKbN0cEpD6c84jWRFSbu2kYyLgacOfHzHxOTynVDDuiOkj+u1kQ6nGKCY65KQiMIqg66G/O8RhXLARGoJfQt10CGcZJvxolBeD82h5R6QFQ3s1zNA0XBo83hHiqBMjKJpz+Ove7Ovmed+gh685Yq6ODfcLJQhcY8tM+ULp94OTuktHJdo4oBeCTHXmVIOubzcgpWcoxxvGW89wNPlfPHDQLQZIZNUWBfXChy7OAqBhKua1Xnni3BYQs4UykwLVbfvgv1RY5P85UGgxCW4I4f1aPUiWQfU/EBPiip/5q0pXe6sxecG1C50g69mWycvCePsrBiGwdJ9HndPaYdUyAll1hPRfAQSp1FPMJ7bqAzZDnUCDFry8s7lzYu3so/VlX/c3Nr7JYT3597mopf0cVg3ONsJweDG/l8L5CwRLOoCKu5gNc4LedcUJ7r2ZpGcMfFkwy3LQbmorCyPO2G96kbor1tYjKxkyI1ZrORSjQ7B39dGPNTJ81TzO9PtLBGH2QrmsNmI2FvJ3xcktyte3OQ+JiNPm0Kf39CR3m1o20Qn/xKofjqvN+0MDnOjzBsFZwxK4UXVCzmM/H87J1eXe6lDxHE6wGYa9GVXt/JUY/7glQE+bWxAFQh5IjQm5YtIMpPhaJKcxV5A3mgm6IeZEqzB6cZ815dYk8EbWgtLlVFJeg=

jobs:
  allow_failures:
    - go: tip

# skip non-trunk PMM-XXXX branch builds, but still build pull requests
branches:
  except:
    - /^PMM\-\d{4}/

go_import_path: github.com/prometheus/node_exporter

install:
  # install reviewdog and golangci-lin
  - curl https://raw.githubusercontent.com/reviewdog/reviewdog/master/install.sh| sh -s
  - curl https://raw.githubusercontent.com/golangci/golangci-lint/master/install.sh | sh -s latest

before_script:
  # static analyze
  - bin/golangci-lint run -c=.golangci-required.yml --out-format=line-number | bin/reviewdog -f=golangci-lint -level=error -reporter=github-pr-check
  - bin/golangci-lint run -c=.golangci.yml --out-format=line-number | bin/reviewdog -f=golangci-lint -level=error -reporter=github-pr-review

script:
  - go install -v ./...

notifications:
  slack:
    on_success: change
    on_failure: always
    rooms:
      secure: Vk7CAMwGcXwGdsJW5uRBbpsCtjW3bNd+qz2/cl75z3Mbs8PZNHJWpbJDdtdBOgthPdLfMw4ewjnzy/Jdv06JNLh2+APb+WG1BkfOJcerWAYsYgk8IeT45CgeDJFrEF/xVwPjiwrddjvSbxH8MGimGC4FjSSDbgL2izvbzKK1L7iqVseFClDsmxq/PR1fTdAv1y4y4/g0Cj3fH97bYVJOdkoZ+1te2TD/AxetsObgPskxIwT39gZsYJsO88DSCG9nOVoCFKZPIqok6oepgI0ejR7wlZyrNaeTAx4ygea28IfDBUKnD0xSVP4sTfJTdPBEtVS4R2Cvy/lqRteDvDnAgZpzfdfh6GDp55x62Y+3eSRLjD9M0VcStVm6ltpA4wl+orEF/jeIs5AW2g0U72AgaZO7GqDqBjf3NoRyWqGqaXKSq1oZx/nftzRALpBiD9ly/jl5pwxIcOqZ0Mt9uKHIHfnE9jxxdCE+uSlwU6fidMf3lX+IDFWhvtyOWaivB0JvhWLwZ1KNBBYlXQ+x7Uj0kKwg7kqHCUVoxspFSOeftGJJhLmhnFlZQVH3RbAWN9jx7S31sIYYzEDI1uhCSPCY0Aw/JRn+A1uc6kvBADWjgbVq+p+8O5npFor9xqFvbi1oS03H1R8afVYeGxfDT5OcfSaR5gejgLUrLpK/0RHySL8=
